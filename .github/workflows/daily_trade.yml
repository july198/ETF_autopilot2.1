name: ETF Auto Trader

on:
  workflow_dispatch:
  schedule:
    - cron: "0 1 * * 2-6"  # UTC 01:00 = 北京时间 09:00（周二到周六）

jobs:
  run_daily:
    runs-on: ubuntu-latest

    env:
  TZ: Asia/Shanghai
  SMTP_USER: ${{ secrets.SMTP_USER }}
  SMTP_PASS: ${{ secrets.SMTP_PASSWORD }}
  SMTP_TO:   ${{ secrets.TO_EMAIL }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 只打印长度，不泄露你的密码
      - name: Check email env (length only)
        run: |
          python - <<'PY'
          import os
          for k in ["SMTP_USER","SMTP_PASS","SMTP_TO"]:
              v = os.getenv(k, "")
              print(f"{k}: {'OK' if v else 'MISSING'} len={len(v)}")
          PY

      - name: Run daily trader script
        run: |
          python ./scripts/run_daily.py
